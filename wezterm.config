-- Pull in the wezterm API
local wezterm = require 'wezterm'
local act = wezterm.action

-- This will hold the configuration.
local config = wezterm.config_builder()

-- Detect OS
local is_macos = wezterm.target_triple:find("darwin") ~= nil

-- Primary mod key:
-- macOS: CMD, Linux: SUPER (Windows key)
local MOD = is_macos and "CMD" or "SUPER"

-- Alt key naming:
-- macOS uses OPT in docs, Linux uses ALT
local ALT = is_macos and "OPT" or "ALT"

-- Theme / font
config.color_scheme = 'Monokai Pro (Filter Machine)'
config.font = wezterm.font('JetBrains Mono', { weight = "Bold" })

-- Pane split line color
config.colors = {
  split = "#00FF00",
}

config.keys = config.keys or {}

for _, key_binding in ipairs({
  -- Splits
  {
    key = 'd',
    mods = MOD,
    action = act.SplitHorizontal { domain = 'CurrentPaneDomain' },
  },
  {
    key = 'D',
    mods = MOD .. '|SHIFT',
    action = act.SplitVertical { domain = 'CurrentPaneDomain' },
  },

  -- Close pane
  {
    key = 'w',
    mods = MOD,
    action = act.CloseCurrentPane { confirm = false },
  },

  -- Clear scrollback + viewport
  {
    key = 'k',
    mods = MOD,
    action = act.ClearScrollback 'ScrollbackAndViewport',
  },

  -- Pane navigation:
  -- macOS: CMD+OPT+Arrow
  -- Linux: SUPER+ALT+Arrow
  {
    key = 'LeftArrow',
    mods = MOD .. '|' .. ALT,
    action = act.ActivatePaneDirection 'Left',
  },
  {
    key = 'RightArrow',
    mods = MOD .. '|' .. ALT,
    action = act.ActivatePaneDirection 'Right',
  },
  {
    key = 'UpArrow',
    mods = MOD .. '|' .. ALT,
    action = act.ActivatePaneDirection 'Up',
  },
  {
    key = 'DownArrow',
    mods = MOD .. '|' .. ALT,
    action = act.ActivatePaneDirection 'Down',
  },

  -- Zoom pane
  {
    key = 'Enter',
    mods = MOD .. '|SHIFT',
    action = act.TogglePaneZoomState,
  },
}) do
  table.insert(config.keys, key_binding)
end

-- Pick something big but sane.
config.scrollback_lines = 200000

config.window_background_opacity = 0.9

return config
